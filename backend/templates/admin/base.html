{% extends "admin/base.html" %}

{% block extrahead %}
{{ block.super }}
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Silent timezone detection for Django admin (no popup, no auto-refresh)
    function detectAndSetTimezone() {
        // Check if timezone is already detected in this session
        if (sessionStorage.getItem('timezone_detected')) {
            return;
        }
        
        try {
            // Use Intl API to detect browser timezone
            const detectedTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            if (detectedTimezone) {
                console.log('Detected browser timezone:', detectedTimezone);
                
                // Send timezone to server
                fetch('/api/timezone/detect/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || '',
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify({
                        timezone: detectedTimezone
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Timezone successfully set on server:', data.timezone);
                        
                        // Mark timezone as detected in session storage
                        sessionStorage.setItem('timezone_detected', 'true');
                        sessionStorage.setItem('user_timezone', data.timezone);
                        
                        // NO POPUP - removed showTimezoneNotification() call
                        // NO AUTO-REFRESH - removed the page reload logic
                    } else {
                        console.warn('Failed to set timezone:', data.error);
                    }
                })
                .catch(error => {
                    console.error('Error setting timezone:', error);
                });
            } else {
                console.warn('Could not detect browser timezone');
            }
        } catch (error) {
            console.error('Timezone detection failed:', error);
        }
    }
    
    // Run timezone detection after a short delay to ensure page is fully loaded
    setTimeout(detectAndSetTimezone, 500);
});
</script>
{% endblock %}